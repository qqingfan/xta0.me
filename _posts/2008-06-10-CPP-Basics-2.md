---
layout: post
title: C++ Part2
categories: PL
tag: C++
mathml: true
---

> 持续更新，补充C++新增feature,目录结构遵循《C++ Primer》

# Part 2

## IO库

### IO类
- 标准库中三个类
	- `iostream`定义了用于读写流的基本类型
		- `istream`,`wistream` 从流读取数据
		— `ostream`,`wostream` 向流写入数据
		- `iostream`,`wiostream` 读写流
	- `fstream`定义了读写文件的类型
		- `ifstream` : 从文件中读数据
		- `ofstream`: 向文件中写数据
		- `fstream`: 文件读写流
	- `sstream`定义了读写内存`string`对象的类型
		- `istringstream`
		- `ostreamstream`
		- `stringstream` 	

- 继承关系如下:

![](/assets/images/2008/06/iostream.png)

- 标准流对象：
	- `cin`标准输入流，用于从键盘读取数据，也可以被重定向为从文件中读取数据
	- `cout`对应标准输出流，用于向屏幕输出数据，也可以被重定向为向文件写入数据
	- `cerr`对应标准错误处输出流，用于向屏幕输出错误信息
	- `clog`对应标准错误输出流，用于向屏幕输出出错信息
	- `cerr`和`clog`的区别在于`cerr`不适用缓冲区，而输出到`clog`中的信息会先被存放到缓冲区，缓冲区满了才刷新到屏幕

```cpp
#include <iostream>
using namepsace std;
int main(){
	//输出重定向
	int x,y;
	cin >> x>>y;
	freopen("test.txt","w",stdout); //将标准输出重定向到test.txt中
	if(y == 0){
		cerr<<"error"<<endl; //cout被重定向到文件，调试信息可使用cerr输出
	}else{
		cout << x/y; 将结果输出到test.txt中
	}
	
	//输入重定向
	double f; int n;
	freopen("t.txt","r",stdin); //cin被改为从t.txt中读取数据
	cin>>f>>n; //t.txt中的文件存放格式要符合cin的要求， t.txt: 3.14 123
	cout<<f<<","<<n<<endl; //3.14,123
	return 0;
}
```

- 向文件中写入`struct`

### 文件操作

- 简单读写文件

```cpp
fstream fout("text.txt",ios::out | ios::binary);//使用基类fstream，需要指明读写类型
//或者使用ofstream
//ostream fout("text.txt");
if(fout.is_open()){
	//使用流操作符
	fout<<"Hello there"<<endl;
	fout<<123<<endl;
	fout.close();
}else{
	cout<<"Could not create file: text.txt"<<endl; 
}

//读文件
ifstream fin("text.txt");
if(fin.is_open()){
	string line;
	//使用getline
	while(!fin.eof()){
		getline(fin, line);
		cout<<line<<endl;
		fin>>ws; //抛弃掉line末尾的换行
		if(!input){
			break;
		}
	}
	fin.close();
}else{
	cout<<"Could not read file: text.txt"<<endl;
}
```
- 读写结构体
	- 由于编译器有内存对齐的优化，因此`struct`实际的size可能会变大，所以需要要先压缩结构体

	```cpp
	#pragma pack(push, 1)
	struct Person{
		char name[50]; //50 bytes
		int x; //4 bytes
		double p;//8 bytes
	};
	#pragma pack(pop) //结构体的size从64 bytes变成62bytes

	int main(){
		//写二进制文件
		Person someone{"Frodo",220, 0.8};
		ofstream fout{"test.bin",ios::binary}; //二进制文件
		fout.write(reinterpret_cast<char*>(&someone), sizeof(Person));
		fout.close();

		//读二进制文件
		 Person frodo = {};
		ifstream fin{"test.bin",ios::binary};
		fin.read(reinterpret_cast<char*>(&frodo), sizeof(Person));
		fin.close();
	}
	```
## 顺序容器



## 内存分配

### `new`和`delete`

- new

  - 创建一个T类型的指针：`T* p = new T;`

  ```c++
  int *pn = NULL;
  pn = new int(5);
  ```

  - 创建一个T类型的数组：`T* p = new T[N];`

- delete

  - delete两次会报错

  ```c++
  int* p = new int(5);
  delete p;
  delete p; //error!
  ```

  - delete 数组：

  ```c++
  int *p = new int[20];
  p[0] = 1;
  delete[] p;
  ```

### 