---
list_title: Building a Parser By Hand - 1
title: Build a Parser
layout: post
---

### Prerequist Knowledge

- Computation Theory
    - FNA
    - Formal Language
    - Regular Language
    - Context Free Grammar
- Algorithms
    - Recursion
- Tools
    - Python Syntax
    - Regular Expression

### FSM的python 表示

正则式`a+1+`的FSM为：

<img class="img-center" src="/assets/images/2015/07/fsm-1.png">

上述FSM用python可以表示如下：

```python
edges = {
    (1,'a') : 2, #state#1 takes an input of 'a', transfer the state to #2
    (2,'a') : 2,
    (2,'1') : 3,
    (3,'1') : 3
}
```
接下来，可以设计这样一个函数，接受一个输入字符串，和其实状态id，参照上面的状态机来判断输入字符是否能被状态机接受

```python
accepting = [3] #状态机的结束状态，可能有多个结束状态，用array表示
def fsmsim(string, current, edges, accepting):
    if string == "":
        return current in accepting
    else:
        letter = string[0]
        key = (current,letter)
        if key in edges:
            next_state = edges[key]
            remaining_string = string[1:]
            return fsmsim(remaining_string,next_state,edges,accepting)
        else:
            return False;

print(fsmsim("aaa111",1,fsm,accepting)) #=>True 
print(fsmsim("a1a1a1",1,fsm,accepting)) #=>Flase
print(fsmsim("",1,fsm,accepting)) #=>Fals
```
回顾一下上面的过程，其思路为:

1. 由正则式 ---> FSM状态机 ---> 用`map<tuple<int,char>,int>`表示
2. 设计`fsmsim`函数，解析输入字符串
3. 观察是否匹配正则式（能被状态机接受）

接下来再来看几个例子，假如正则式换为`r"q*"`，修改FSM状态机和Accept State为：

<img class="img-center" src="/assets/images/2015/07/fsm-2.png">

```python
edges = {
    (1,'q'):1
}
accepting = [1]

print fsmsim("",1,edges,accepting)# >>> True
print fsmsim("q",1,edges,accepting)# >>> True
print fsmsim("qq",1,edges,accepting)# >>> True
print fsmsim("p",1,edges,accepting)# >>> False
```

接下来再来看几个例子，假如正则式换为`r"[a-b][c-d]?"`，修改FSM状态机和Accept State为：

<img class="img-center" src="/assets/images/2015/07/fsm-3.png">

```python
edges = {
    (1,'a'):2,
    (1,'b'):2,
    (2,'c'):3,
    (2,'d'):3
}
accepting = [2,3]
print fsmsim("a",1,edges,accepting)# >>> True
print fsmsim("b",1,edges,accepting)# >>> True
print fsmsim("ad",1,edges,accepting)# >>> True
print fsmsim("e",1,edges,accepting)# >>> False
```
