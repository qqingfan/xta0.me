---
updated: "2018-08-23"
layout: post
title: 高性能，高可用，可扩展
list_title: 系统设计（二）| System Design | 三个目标 | Performance, Availability and Scalibilty
categories: [backend]
---

## 高性能

上一篇我们对系统架构的各个环节进行了简单的介绍，这篇文章我们先来介绍一下价系统设计的三个目标，分别是高性能，高可用和可扩展，这三条目标不仅适用于服务端架构，对于客户端，前端同样适用。高性能分为单机高性能以及集群高性能，单机高性能主要集中在对进程，线程的管理以及I/O操作模型上，比如Nginx可以用多进程也可以用多线程，JBoss 采用的是多线程；Redis 采用的是单进程，Memcache 采用的是多线程，这些系统都实现了高性能，但内部实现差异却很大。 集群高性能指的是当单机性能无法支撑业务访问量时，必须采用机器集群的方式来提高性能，比如支付宝和微信这种规模的业务系统，后台机器数量都是百万级别的。

### 延时和吞吐量

不论是单机还是集群，衡量性能的两个重要指标分别为延时和吞吐量。所谓延时是指每次请求的链路耗时，单位是时间单位；吞吐量是指单位时间内能处理多少次请求。打个简单的比方，有一家汽车修理厂，修理一辆汽车耗时8小时，一天能够修理120量车，那么这家汽车修理厂的：

1. 延时为8小时
2. 吞吐量为：120辆车/天 或者 5辆车/小时

吞吐量通常用TPS和QPS表示，`TPS`是每秒内的事务(Transaction)数，一次事物包括和响应客户端请求，执行业务逻辑，将结果返回客户端三部分；`QPS`是指每秒内查询次数，比如一次TPS包含了若干次数据库查询操作，因此QPS的值 >= TPS的值

### 集群高性能

通过集群来提升性能并非是加机器这么简单，集群间机器的通信也会带来一定性能的消耗，因此，让多台机器协同工作达到高性能是一个复杂的任务。我们先从一个最简单的场景分析：

<img src="{{site.baseurl}}/assets/images/2016/05/sd-2-1.png">

上图是一个横向扩展的例子，首先我们有一个单机应用，假设它的TPS是1000，随着业务的发展，用户量的增加，单机性能已经难以维持，因此我们又加了一台业务服务器（图（2）），此时TPS变成了2000，除去Load Balancer的损耗，实际TPS大约为1600。接着又过了一段时间，用户数量持续增加，此时业务要求系统的TPS达到1万，我们继续扩容，将业务服务器扩展到10台，此时我们发现，性能非但没有提升，反而下降了，经排查发现单个的Load Balancer已经不足以支撑起TPS 1万的请求了，因此我们需要多个Load Balancer，此时系统变成了图（3）的样子。这时的架构显然已经变得复杂了，体现在：

1. 为了将用户分到不同的Load Balancer上，我们需要对DNS进行配置，或者将DNS和CDN进行关联等
2. 业务服务器和Load Balancer之间的链接由线性结构变成了网状结构
3. 业务服务器从2台扩展到10台，Load Balancer从1台扩展到了3台，各业务系统之间的状态管理，数据同步开始变的复杂，故障数也开始增加，整体监控的难度也加大了

尽管管理集群的代价变高了，但是在性能上我们确实得到了提升，从1台机器变成10台机器，除去Load Balancer的损耗，整体性能大概提升了8倍。但是又过了一段时间，单机上的业务越来越复杂，性能又开始下降，10台机器性能可能只提升了5倍，经排查发现单机耗时明显增加，为了继续提升性能，我们采用了第二种方式，将任务拆解。






## Resource

- [高可用系统](https://coolshell.cn/articles/17459.html)